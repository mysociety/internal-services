#!/usr/bin/perl -w
#
# fixindex:
# Fix the indices generated by the buggy version of 10kfull.
#
# Copyright (c) 2006 UK Citizens Online Democracy. All rights reserved.
# Email: chris@mysociety.org; WWW: http://www.mysociety.org/
#

my $rcsid = ''; $rcsid .= '$Id: fixindex,v 1.1 2006-09-22 13:57:01 francis Exp $';

use strict;

use constant SUBTILES_PER_TILE => 31;

while (defined(my $line = <STDIN>)) {
    chomp($line);
    if ($line =~ /^(0|[1-9]\d*) (0|[1-9]\d*) ([0-9a-f]+)$/) {
        my ($x, $y, $id) = ($1, $2, $3);
        $y = int($y / SUBTILES_PER_TILE) * SUBTILES_PER_TILE
                    + SUBTILES_PER_TILE - 1 - ($y % SUBTILES_PER_TILE);
        print "$x $y $id\n";
    } else {
        print "$line\n";
    }
}
